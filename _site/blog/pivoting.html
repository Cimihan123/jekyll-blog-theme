<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Ubuntu|Roboto'>
    <link rel="stylesheet" href="/assets/css/blog-detail.css">  
    <link rel="stylesheet" href="/assets/css/monokai.css">  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Blog</title>
</head>

<body>

    <nav>
    <div class="hamburger">
      <div class="line1"></div>
      <div class="line2"></div>
      <div class="line3"></div>
    </div>
    <ul class="nav-links">
      <li><a href="/resume">Resume</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/home">Home</a></li>
      <li><a href="/contact">Contact</a></li>
      <li><a href="/about">About Me</a></li>

    </ul>
  </nav>  

  

    <header id="page-title" class="jumbotron background">
        <div id="title-image" class="bg">
            <img src="/assets/thumbnail/phish.png" alt="">
        </div>
        <div class="container">
            <div class="horizontal-center vertical-center">
                <h1 class="article-title">Docker: Pivoting Lab</h1>
                <!-- <h2 class="article-subtitle">Surfing Away on Pennies a Day</h2> -->
            </div>
        </div>
    </header>

    <div class="backclick">
        <a onclick="window.location.href='../blog';"> <i class="fa-solid fa-arrow-left-long"></i></a>

    </div>
    <div class="container foreground">
        <div class="row">
            <div class="col-lg-12">
                <div class="bs-component">
                    <article>
                        <h3 id="pivoting">Pivoting…</h3>

<p>You may be familiar with the concept of pivoting. Pivoting is the way to move from one comporised system to another system.
<br /></p>

<p>Suppose,
<br />
“A”  has access “B”.<br />
“B” has access “C”.<br />
“A” does not have access “C”.<br /></p>

<p>So how can we access “C” directly from “A”? Well, that’s direcly not possbile so we use the concept of pivoting. “A” can use “B” as the foothold to get access to “C”.
“A” first compromise the system “B” then can use this machine as the lauch point to attack the “C”.</p>

<h2 id="lab-creation-overview">Lab Creation Overview</h2>

<p>To have some practises on pivoting I created a lab in docker.</p>

<p>Figure below gives the overview of the network setup of the docker compose files.
Victim1 and Victim2 are our targets.They are on subnet <em>172.16.101.0/24</em>. Attacker is on different subnet <em>172.16.100.0/24</em>.</p>

<p>Our helper machine  ( gateway machine ) will sit on both subnetworks.</p>

<p><img src="/assets/img/blog4-pivoting/1-overview.png" alt=" pivoting image &gt;&lt;" /></p>

<p> </p>

<h3 id="brief-overview-of-docker-compose-files">Brief Overview of Docker Compose Files</h3>

<p>You can get the docker compose files from my github repo.</p>

<p>Github Link: <a href="https://github.com/Cimihan123/Pivoting">Repository</a></p>

<p>For this lab two networks  are created:-</p>

<ol>
  <li>
    <p><strong>attacker</strong> -&gt; having subnet <em>172.16.100.0/24</em></p>
  </li>
  <li>
    <p><strong>victim</strong> -&gt; having subnet <em>172.16.101.0/24</em></p>
  </li>
</ol>

<p>By default docker use bridge driver. For this lab also we are sticking with it although we can specify different network drivers.</p>

<p><img src="/assets/img/blog4-pivoting/2-subnet.png" alt=" subnet image &gt;&lt;" /></p>
<p align="center">Fig: docker-compose-subnet.yml</p>

<p> </p>

<p>Notice <em>helper</em> container is built locally. This will make easy as the base image will be customized rather than pulling everytime.</p>

<p>This container is part of the both networks: attacker and victim.</p>

<p><img src="/assets/img/blog4-pivoting/3-helper.png" alt=" helper image &gt;&lt;" /></p>
<p align="center">Fig: docker-compose.yml</p>

<p>A baseimage is being pulled. I won’t recommend to do this in your production enviroment or anywhere. 
I have enable ssh root login.</p>

<p><img src="/assets/img/blog4-pivoting/4-helper-image.png" alt=" helper image &gt;&lt;" /></p>
<p align="center">Fig: helper.Dockerfile</p>

<p><em>attacker</em> is the part of <em>*attacker</em> subnet habing an ip of <em>172.16.100.10</em></p>

<p><img src="/assets/img/blog4-pivoting/5-attacker.png" alt=" attacker image &gt;&lt;" /></p>
<p align="center">Fig: docker-compose.yml</p>

<p><em>attacker</em> container also uses the <em>phusion/baseimage</em>. Additionally some other tools ( ping, nmap etc ) will be installed.</p>

<p><img src="/assets/img/blog4-pivoting/5-attacker-image.png" alt=" attacker image &gt;&lt;" /></p>
<p align="center">Fig: attacker.Dockerfile</p>

<p><em>victim</em> container is also built locally. It does have network ip <em>172.16.101.10</em>. This is the part of subnet <em>172.16.101.0/24</em>.</p>

<p><img src="/assets/img/blog4-pivoting/6-victim1.png" alt=" victim1 image &gt;&lt;" /></p>
<p align="center">Fig: docker-compose.yml</p>

<p>I have installed sar2html Github Link: <a href="https://github.com/cemtan/sar2html/">Repository</a>.</p>

<p>It is the plotting tool for system statistics. There is an issue in this tool. We will discuss about this on different section. For now just assume there is a vulnerability in this tool.</p>

<p><img src="/assets/img/blog4-pivoting/6-victim1-image.png" alt=" victim1 image &gt;&lt;" /></p>
<p align="center">Fig: victim1.Dockerfile</p>

<p>For <em>victim2</em> there is no need to manipluate the image locally. There is already a vulnerable wordpress in docker hub. We just pull it from there. Below image show the structure to configure the wordpress as we also need database server. They are in same subnetwork so they can communicate with each other.</p>

<p><img src="/assets/img/blog4-pivoting/7-victim2.png" alt=" victim2 image &gt;&lt;" /></p>
<p align="center">Fig: docker-compose.yml</p>

<h3 id="running-and-checking">Running and Checking</h3>

<p>As far now we have little overview of our lab enviroment. Now we run the docker compose files and check them.</p>

<p>We first build them. It may take some time for pulling, download and installing. Then we create and run the created containers.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nt">-f</span> docker-compose-subnet.yml <span class="nt">-f</span> docker-compose.yml build
docker-compose <span class="nt">-f</span> docker-compose-subnet.yml <span class="nt">-f</span> docker-compose.yml up <span class="nt">--remove-orphans</span>

</code></pre></div></div>

<p> </p>

<p>There are total of 5 containers running.Once <em>Attacker</em>, <em>helper</em>, <em>victim1</em> and <em>victim2</em> are running then we check the connection between them.</p>

<p><img src="/assets/img/blog4-pivoting/8-dockercompose.png" alt=" dockercomposeup image &gt;&lt;" /></p>
<p align="center">Fig: docker compose build &amp; up</p>

<p><img src="/assets/img/blog4-pivoting/9-attacker-ping-helper.png" alt=" pinging helper image &gt;&lt;" /></p>
<p align="center">Fig: docker compose build &amp; up</p>

      
                </div>
                </article>
            </div>
         
    </div>
    </div>
    <div class="line" ></div>

    <div class="container foreground">
        <h1>Recent Posts</h1>
        
        
        <article class="article-preview">
            <div class="row">
                <div class="col-sm-2">
                    <h2 class="publish-day">03</h2>
                    <div class="publish-month">2022</div>
                </div>
                <div class="col-sm-10">
                    <h2 class="post-title"><a href="/blog/pivoting">Docker: Pivoting Lab</a></h2>
                    <!-- <h3 class="post-subtitle">Surfing Away on Pennies a Day</h3>   <a href="#"> -->
                    <a href="/blog/pivoting">
                        <img src="/assets/thumbnail/phish.png" class="author-image">
                        <!-- <span class="author-name">Brian Barrett</span> -->
                    </a>
                    <div class="post-preview">
                        <p>
                            
                            
                        </p>
                    </div>

                </div>
            </div>
        </article>
        
        <article class="article-preview">
            <div class="row">
                <div class="col-sm-2">
                    <h2 class="publish-day">21</h2>
                    <div class="publish-month">2022</div>
                </div>
                <div class="col-sm-10">
                    <h2 class="post-title"><a href="/blog/proxy">Proxy: Accessing Network Connection</a></h2>
                    <!-- <h3 class="post-subtitle">Surfing Away on Pennies a Day</h3>   <a href="#"> -->
                    <a href="/blog/proxy">
                        <img src="/assets/thumbnail/squid.webp" class="author-image">
                        <!-- <span class="author-name">Brian Barrett</span> -->
                    </a>
                    <div class="post-preview">
                        <p>
                            
                            <p><span style="font-size:30px;">I</span>n this blog, I will explain how to access network connections on Tryhackme/HTB/etc…. machines.Having an internet connection will make it a lot easier when we are trying to pwn machines</p>
                        </p>
                    </div>

                </div>
            </div>
        </article>
        
        <article class="article-preview">
            <div class="row">
                <div class="col-sm-2">
                    <h2 class="publish-day">16</h2>
                    <div class="publish-month">2022</div>
                </div>
                <div class="col-sm-10">
                    <h2 class="post-title"><a href="/blog/phish">Phishing: Creating and Analyzing</a></h2>
                    <!-- <h3 class="post-subtitle">Surfing Away on Pennies a Day</h3>   <a href="#"> -->
                    <a href="/blog/phish">
                        <img src="/assets/thumbnail/phish.png" class="author-image">
                        <!-- <span class="author-name">Brian Barrett</span> -->
                    </a>
                    <div class="post-preview">
                        <p>
                            
                            <p><span style="font-size:30px;">I</span>n this blog, I am going to phish myself. Jumping directly into a conclusion does not make sense so I will be explaining from “how-to-create” to “how-to-do”.</p>
                        </p>
                    </div>

                </div>
            </div>
        </article>
        
        <article class="article-preview">
            <div class="row">
                <div class="col-sm-2">
                    <h2 class="publish-day">07</h2>
                    <div class="publish-month">2021</div>
                </div>
                <div class="col-sm-10">
                    <h2 class="post-title"><a href="/blog/usb-btlo">Suspicious USB Stick</a></h2>
                    <!-- <h3 class="post-subtitle">Surfing Away on Pennies a Day</h3>   <a href="#"> -->
                    <a href="/blog/usb-btlo">
                        <img src="/assets/thumbnail/btlo.png" class="author-image">
                        <!-- <span class="author-name">Brian Barrett</span> -->
                    </a>
                    <div class="post-preview">
                        <p>
                            
                            <p><span style="font-size:30px;">O</span>ne of our clients informed us they recently suffered an employee data breach. As a startup company, they had a constrained budget allocated for security and employee</p>
                        </p>
                    </div>

                </div>
            </div>
        </article>
        

        </div>
    </div>
    <!--scroller-->
    <div class=title>
    </div>
    <div id="jsScroll" class="scroll" onclick="scrollToTop();">
        <i class="fa fa-angle-up"></i>
    </div>
</body>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<script>
		//scroller
		window.addEventListener('scroll', e => {
		var el = document.getElementById('jsScroll');
		if (window.scrollY > 200) {
			el.classList.add('visible');
		} else {
			el.classList.remove('visible');
		}
	});

	function scrollToTop() {
		window.scrollTo({
			top: 0,
			behavior: 'smooth'
		});
	}
</script>
<script>
	const hamburger = document.querySelector(".hamburger");
	const navLinks = document.querySelector(".nav-links");
	const links = document.querySelectorAll(".nav-links li");

	hamburger.addEventListener('click', () => {
		//Animate Links
		navLinks.classList.toggle("open");
		links.forEach(link => {
			link.classList.toggle("fade");
		});

		//Hamburger Animation
		hamburger.classList.toggle("toggle");
	});


</script>


<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
